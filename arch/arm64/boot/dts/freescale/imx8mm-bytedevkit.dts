// SPDX-License-Identifier: GPL-2.0+
/*
 * Copyright (C) 2021 bytes at work AG - https://www.bytesatwork.io
 *
 * Based on imx8mm-ddr4-evk.dts:
 * Copyright 2018 NXP
 *
 */

/dts-v1/;

#include "imx8mm-byteengine.dtsi"
#include <dt-bindings/net/ti-dp83867.h>

/ {
	model = "byteDEVKIT";
	compatible = "batw,bytedevkit", "batw,byteengine-imx8mm", "fsl,imx8mm";

	chosen {
		bootargs = "console=ttymxc0,115200 earlycon=ec_imx6q,0x30890000,115200";
		stdout-path = &uart2;
	};

	aliases {
		mmc0 = &usdhc3;
		mmc1 = &usdhc2;
		/delete-property/ mmc2;
		serial0 = &uart2;
	};

	backlight {
		compatible = "pwm-backlight";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_backlight>;
		enable-gpios = <&gpio1 6 GPIO_ACTIVE_HIGH>;
		pwms = <&pwm1 0 5000000>;
		brightness-levels = <0 4 8 16 32 64 128 255>;
		default-brightness-level = <5>;
	};

	vbus_usb2: fixedregulator1 {
		compatible = "regulator-fixed";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_usb2>;
		regulator-name = "vbus_usb2";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio5 3 GPIO_ACTIVE_HIGH>;
	};
};

&iomuxc {
	pinctrl_uart2: uart2grp {
		fsl,pins = <
			MX8MM_IOMUXC_UART2_RXD_UART2_DCE_RX	0x140	/* F15  UART2_RXD */
			MX8MM_IOMUXC_UART2_TXD_UART2_DCE_TX	0x140	/* E15  UART2_TXD */
		>;
	};

	pinctrl_usdhc2_gpio: usdhc2grpgpio {
		fsl,pins = <
			MX8MM_IOMUXC_SD2_CD_B_GPIO2_IO12	0x1c4
		>;
	};

	pinctrl_usdhc2: usdhc2grp {
		fsl,pins = <
			MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK		0x194
			MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD		0x1d4
			MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0	0x1d4
			MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1	0x1d4
			MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2	0x1d4
			MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3	0x1d4
		>;
	};

	pinctrl_backlight: backlight {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO06_GPIO1_IO6	0x19	/* GPIO1_IO06  Backlight PIO1_IO06   */
		>;
	};

	pinctrl_lcd: lcd {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO13_GPIO1_IO13	0x19	/* GPIO1_IO06  GPIO1_IO06  LCD Reset */
			MX8MM_IOMUXC_GPIO1_IO10_GPIO1_IO10	0x19	/* GPIO1_IO06  GPIO1_IO06  LCD Reset */
			MX8MM_IOMUXC_GPIO1_IO01_PWM1_OUT	0x116	/* Backlight PWM */
		>;
	};

	pinctrl_usb2: usb2 {
		fsl,pins = <
			MX8MM_IOMUXC_SPDIF_TX_GPIO5_IO3		0x19	/* SPDIF_TX  GPIO5_IO03  USB1.EN */
		>;
	};
};

&lcdif {
	status = "okay";
};

&mipi_dsi {
	status = "okay";

	panel@0 {
		compatible = "youritec,ili9806";
		reg = <0>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_lcd>;
		reset-gpios = <&gpio1 13 GPIO_ACTIVE_HIGH>;
		dsi-lanes = <2>;
		video-mode = <2>;       /* 0: burst mode
					 * 1: non-burst mode with sync event
					 * 2: non-burst mode with sync pulse
					 */
		panel-width-mm = <62>;  /* active area */
		panel-height-mm = <110>;
		status = "okay";
	};
};

&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart2>;
	status = "okay";
};

&usbotg1 {
	dr_mode = "peripheral";
	status = "okay";
};

&usbotg2 {
	dr_mode = "host";
	status = "okay";
};

&usbphynop2 {
	vbus-regulator = <&vbus_usb2>;
};

&usdhc2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
	bus-width = <4>;
	cd-gpios = <&gpio2 12 GPIO_ACTIVE_LOW>;
	status = "okay";
};

&pwm1 {
	status = "okay";
};
